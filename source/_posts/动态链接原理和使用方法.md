---
title: 动态链接原理和使用方法
date: 2019-01-21 20:09:46
categories:
tags:
    - 动态链接
    - Java
cover_picture:
---
<!-- <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.4/MathJax.js?config=default"></script> -->


本文介绍动态链接的原理以及在各个平台上创建和使用动态链接库的方法. 附带地, 本文也会涉及静态库的原理以及如何创建和使用静态库.



静态连接与动态链接
--------------------

静态库实际上是一组二进制的代码, 在编译的时候, 我们引用的静态库函数会直接复制到我们的程序之中. 动态库也是一组二进制代码, 但是编译的时候我们的程序并不包含相关的代码, 而是在运行的时候动态的去获得需要的代码.


Windows下的创建方法
-------------------------

在Windows下, 对于静态库, 通常只需要发布一个`.lib`文件. 其中就包含了全部的代码. 而对于动态库, 则需要同时发布`.lib`文件和`.dll`文件. 其中`.lib`文件仅包含一些链接的信息, 仅在程序的链接阶段使用. 而`.dll`文件包含实际的代码, 在程序运行的时候使用.

如果使用Visual Studio进行开发, VS在创建Win32项目时, 可以直接选择创建DLL或者静态库. 选择相应的项目后直接编译就可以产生相应的库文件.

其中的一些细节可以参考一下的文章

- [手把手教你如何制作和使用lib和dll - CSDN](https://blog.csdn.net/sj2050/article/details/81700183)
- [DLLs in Visual C++ -Microsoft Docs](https://docs.microsoft.com/en-us/cpp/build/dlls-in-visual-cpp?view=vs-2017)


Linux下的创建方法
-------------------
与Windows平台相对应, 在Linux平台上, 静态库以`.a`结尾, 而动态库以`.so`结尾. 由于我懒, 就不多介绍了, 可以阅读以下的博客

- [linux 中的.so和.a文件 -CSDN](https://blog.csdn.net/nieyinyin/article/details/6890557)
- [关于linux下的.a文件与 .so 文件 -暴力的轮胎](https://www.cnblogs.com/luntai/p/5291354.html)


Java调用C++
--------------

本节介绍如何通过Java调用C++编译出来的DLL. 步骤如下:

1. 创建Java类, 使用native关键字声明相关的函数
2. 编译Java文件, 产生class文件
3. 使用JDK中的javah工具指定相应的class文件来产生需要的头文件
4. 使用VS创建DLL项目, 引入第三步产生的头文件,并且导入JDK中的jni.h和jni_md.h
5. 根据头文件实现相应的函数, 然后编译C++程序, 产生相应的DLL
6. 将编译产生的DLL放置到PATH变量包含的路径之中
7. Java中使用loadLibrary加载DLL

更细致的步骤可以参考以下的内容
- [Java调用C++动态链接库dll -成都汇智动力](http://m.sohu.com/a/246320140_100181197)